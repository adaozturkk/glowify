@model Glowify.Models.ViewModels.ProductDetailsVM

<div class="container mt-5">
    <div class="mb-4">
        <a asp-action="Index" class="text-decoration-none text-muted small hover-link">
            <i class="bi bi-arrow-left"></i> Back to Shop
        </a>
    </div>

    <div class="row">
        <div class="col-lg-5 col-md-12 mb-5">
            <div class="position-relative overflow-hidden rounded-4 shadow-sm">
                <img src="@(string.IsNullOrEmpty(Model.ShoppingCart.Product.ImageUrl) ? "https://placehold.co/500x600/png" : Model.ShoppingCart.Product.ImageUrl)"
                     class="img-fluid w-100"
                     style="object-fit: cover; min-height: 500px;"
                     alt="@Model.ShoppingCart.Product.Name" />

                @if (Model.ShoppingCart.Product.Stock <= 0)
                {
                    <span class="position-absolute top-0 start-0 bg-dark text-white px-3 py-2 m-3 rounded-pill text-uppercase small fw-bold shadow">Sold Out</span>
                }
            </div>
        </div>

        <div class="col-lg-7 col-md-12">
            <form method="post">
                <input asp-for="ShoppingCart.ProductId" hidden />

                <div class="ps-lg-4">
                    <div class="mb-3">
                        <span class="badge bg-light text-dark border rounded-pill px-3 py-2 text-uppercase ls-1">
                            @Model.ShoppingCart.Product.Category
                        </span>
                        <span class="badge bg-secondary bg-opacity-10 text-dark rounded-pill px-3 py-2 ms-2">
                            <i class="bi bi-stars"></i> @Model.ShoppingCart.Product.TargetSkinType Skin
                        </span>
                    </div>

                    <h1 class="fw-bold text-dark display-6 mb-1">@Model.ShoppingCart.Product.Name</h1>
                    <p class="text-muted small text-uppercase fw-bold mb-4 ls-2">Glowify Skincare</p>

                    <div class="d-flex align-items-center mb-4">
                        @if (Model.ReviewCount > 0)
                        {
                            <div class="d-flex align-items-center me-4">
                                <div class="text-warning d-flex align-items-center me-2 fs-6">
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        if (i <= Model.AverageRating)
                                        {
                                            <i class="bi bi-star-fill"></i>
                                        }
                                        else if (Model.AverageRating >= i - 0.5)
                                        {
                                            <i class="bi bi-star-half"></i>
                                        }
                                        else
                                        {
                                            <i class="bi bi-star"></i>
                                        }
                                    }
                                </div>
                                <span class="fw-bold text-dark fs-5" style="line-height: 1;">@Model.AverageRating.ToString("0.0")</span>
                            </div>

                            <div class="text-muted small">
                                <span class="badge bg-light text-secondary border rounded-pill px-3 py-1">
                                    @Model.ReviewCount Review@(Model.ReviewCount > 1 ? "s" : "")
                                </span>
                            </div>
                        }
                        else
                        {
                            <div class="text-muted small d-flex align-items-center">
                                <i class="bi bi-star text-secondary opacity-50 fs-5 me-2"></i>
                                <span>No reviews yet. Be the first!</span>
                            </div>
                        }
                    </div>

                    <div class="mb-4">
                        @if (Model.ShoppingCart.Product.ListPrice > Model.ShoppingCart.Product.Price)
                        {
                            <span class="text-decoration-line-through text-muted fs-5 me-2">
                                @Model.ShoppingCart.Product.ListPrice.ToString("c")
                            </span>
                            <span class="text-danger fw-bold display-6">
                                @Model.ShoppingCart.Product.Price.ToString("c")
                            </span>
                        }
                        else
                        {
                            <span class="text-dark fw-bold display-6">
                                @Model.ShoppingCart.Product.Price.ToString("c")
                            </span>
                        }
                    </div>

                    <p class="text-secondary lead mb-4" style="font-size: 1.1rem;">
                        @Model.ShoppingCart.Product.Description
                    </p>

                    <div class="bg-light p-4 rounded-3 mb-4 border border-light">
                        @if (!string.IsNullOrEmpty(Model.ShoppingCart.Product.MainIngredient))
                        {
                            <div class="d-flex align-items-center mb-2">
                                <i class="bi bi-droplet-fill text-primary me-2"></i>
                                <strong class="text-dark me-2">Key Ingredient:</strong>
                                <span class="text-secondary">@Model.ShoppingCart.Product.MainIngredient</span>
                            </div>
                        }

                        @if (!string.IsNullOrEmpty(Model.ShoppingCart.Product.IngredientsList))
                        {
                            <hr class="text-muted opacity-25 my-2">
                            <small class="text-muted d-block mt-2">
                                <strong>Full Ingredients:</strong> @Model.ShoppingCart.Product.IngredientsList
                            </small>
                        }
                    </div>

                    <div class="mb-4">
                        @if (Model.ShoppingCart.Product.Stock > 10)
                        {
                            <div class="text-success fw-bold d-flex align-items-center">
                                <i class="bi bi-check-circle-fill me-2"></i> In Stock & Ready to Ship
                            </div>
                        }
                        else if (Model.ShoppingCart.Product.Stock > 0)
                        {
                            <div class="text-warning fw-bold d-flex align-items-center">
                                <i class="bi bi-exclamation-circle-fill me-2"></i> Low Stock - Only @Model.ShoppingCart.Product.Stock left!
                            </div>
                        }
                        else
                        {
                            <div class="text-danger fw-bold d-flex align-items-center">
                                <i class="bi bi-x-circle-fill me-2"></i> Out of Stock
                            </div>
                        }
                    </div>

                    <div class="row g-2 align-items-center mt-4">
                        @if (Model.ShoppingCart.Product.Stock > 0)
                        {
                            <div class="col-3">
                                <div class="input-group">
                                    <span class="input-group-text bg-white border-dark border-end-0 rounded-start-pill text-muted small">Qty</span>
                                    <input asp-for="ShoppingCart.Count" type="number" value="1" min="1" max="@Model.ShoppingCart.Product.Stock"
                                           class="form-control border-dark border-start-0 text-center fw-bold rounded-end-pill"
                                           style="padding-left:0;">
                                </div>
                            </div>
                            <div class="col-9">
                                <button type="submit" class="btn btn-dark w-100 rounded-pill text-uppercase fw-bold shadow-sm hover-effect py-2">
                                    Add to Cart
                                </button>
                            </div>
                        }
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="row mt-5 pt-5 border-top">
        <div class="col-12">
            <h3 class="fw-bold mb-4">Customer Reviews (@Model.Reviews.Count())</h3>
        </div>

        <div class="col-lg-7">
            @if (Model.Reviews.Any())
            {
                @foreach (var review in Model.Reviews)
                {
                    <div class="card border-0 bg-light mb-3 rounded-4">
                        <div class="card-body p-4">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="fw-bold mb-0">
                                    <i class="bi bi-person-circle me-2 text-secondary"></i> @review.ApplicationUser.Name
                                </h6>
                                <small class="text-muted">
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        if (i <= review.Rating)
                                        {
                                            <i class="bi bi-star-fill text-warning"></i>
                                        }
                                        else
                                        {
                                            <i class="bi bi-star text-muted opacity-25"></i>
                                        }
                                    }
                                </small>
                            </div>

                            <small class="text-muted d-block mb-2" style="font-size: 0.75rem;">
                                @review.ReviewDate.ToString("dd MMM yyyy")
                            </small>

                            <p class="card-text text-secondary mb-0">@review.Comment</p>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="alert alert-light border text-center text-muted py-4">
                    <i class="bi bi-chat-square-dots fs-3 d-block mb-2"></i>
                    No reviews yet. Be the first to share your thoughts!
                </div>
            }
        </div>

        <div class="col-lg-5 mt-4 mt-lg-0">
            @if (Model.CanReview && !Model.HasReviewed)
            {
                <div class="card border-0 shadow-sm rounded-4 sticky-top" style="top: 20px;">
                    <div class="card-body p-4">
                        <h5 class="fw-bold mb-3">Write a Review</h5>
                        <p class="text-muted small mb-4">You purchased this product! Share your experience with us.</p>

                        <form method="post" asp-action="AddReview">
                            <input type="hidden" name="ProductReview.ProductId" value="@Model.ShoppingCart.Product.Id" />

                            <div class="mb-3">
                                <label class="form-label small fw-bold text-uppercase">Rating</label>
                                <select asp-for="ProductReview.Rating" class="form-select border-0 bg-light py-3">
                                    <option value="5">⭐⭐⭐⭐⭐ (Excellent)</option>
                                    <option value="4">⭐⭐⭐⭐ (Good)</option>
                                    <option value="3">⭐⭐⭐ (Average)</option>
                                    <option value="2">⭐⭐ (Fair)</option>
                                    <option value="1">⭐ (Poor)</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="form-label small fw-bold text-uppercase">Your Review</label>
                                <textarea asp-for="ProductReview.Comment" class="form-control border-0 bg-light" rows="4" placeholder="Tell us what you liked or didn't like..."></textarea>
                            </div>

                            <button type="submit" class="btn btn-primary w-100 rounded-pill fw-bold py-2 bg-gradient">
                                Submit Review
                            </button>
                        </form>
                    </div>
                </div>
            }
            else if(Model.HasReviewed)
            {
                <div class="card border-0 bg-light rounded-4 shadow-sm" style="border-top: 4px solid #198754 !important;">
                    <div class="card-body p-4 text-center">
                        <i class="bi bi-check-circle-fill text-success mb-3 d-block" style="font-size: 2.5rem;"></i>
                        <h5 class="fw-bold text-dark mb-2">Review Submitted</h5>
                        <p class="text-muted small mb-0">You have already shared your thoughts on this product. Thank you for your valuable feedback!</p>
                    </div>
                </div>
            }
            else
            {
                <div class="card border-0 bg-light rounded-4">
                    <div class="card-body p-4 text-center">
                        <p class="text-muted small mb-0">Only customers who purchased this product can leave a review.</p>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<style>
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    .ls-1 {
        letter-spacing: 1px;
    }

    .ls-2 {
        letter-spacing: 2px;
    }

    .hover-effect {
        transition: transform 0.2s;
    }

        .hover-effect:hover {
            transform: translateY(-2px);
        }

    .hover-link:hover {
        color: #000 !important;
    }
</style>